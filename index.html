<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Breast Cancer Classification (ONNX Model)</title>
  <link rel="stylesheet" href="styles_11.css" />
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Breast Cancer Prediction (ONNX)</h1>
    <p>
      This demo runs your trained <strong>PyTorch model</strong> (exported to <strong>ONNX</strong>) entirely in the browser
      using <strong>ONNX Runtime Web</strong>. Enter the 30 numeric feature values from the Breast Cancer dataset,
      separated by commas.
    </p>

    <textarea id="features" rows="4" placeholder="Example: 14.5, 20.2, 96.7, ..."></textarea>

    <div class="buttons">
      <button id="predictBtn">Run Prediction</button>
      <button id="clearBtn" class="secondary">Clear</button>
    </div>

    <div id="resultBox" class="hidden">
      <h2>Prediction Result</h2>
      <p id="output"></p>
    </div>

    <footer>
      <p>Deployed with ONNX Runtime Web & GitHub Pages — © 2025 prat459</p>
    </footer>
  </div>

  <script>
    const predictBtn = document.getElementById("predictBtn");
    const clearBtn = document.getElementById("clearBtn");
    const output = document.getElementById("output");
    const resultBox = document.getElementById("resultBox");
    const featuresBox = document.getElementById("features");

    // Prefill example input
    featuresBox.value =
      "14.5, 20.2, 96.7, 600.1, 0.09, 0.07, 0.04, 0.02, 0.15, 0.06, 0.25, 1.5, 2.2, 20.1, 0.004, 0.02, 0.03, 0.01, 0.01, 0.003, 16.4, 26.1, 110.4, 820.4, 0.13, 0.25, 0.27, 0.08, 0.25, 0.09";

    // === Real StandardScaler values ===
    const means = [14.117635165204058, 19.185032989166594, 91.88224167876191, 654.3775827261118, 0.09574402212114125, 0.10361931875020593, 0.08889814501252169, 0.04827987043222842, 0.18109868145906008, 0.0627567691380506, 0.4020158242229577, 1.202686810689968, 2.8582533980463887, 40.07129895346505, 0.0069890747251050486, 0.025635448317708715, 0.03282367231331991, 0.01189394066299588, 0.02057351207381094, 0.0038204556121235037, 16.23510326553177, 25.535692279941433, 107.10312098408794, 876.9870335840917, 0.13153213219983237, 0.2527418023896414, 0.2745945692341263, 0.11418222158860702, 0.2905021975328634, 0.08386784604453779];
    const stds = [3.531927598200702, 4.261314059097716, 24.295284393578864, 354.5529247110507, 0.013907698063783417, 0.05241280552459398, 0.0793805092511797, 0.0380183542762655, 0.02745708532568872, 0.0072017851241921674, 0.2828495550682554, 0.5411516785329613, 2.0689313698369736, 47.18438186772948, 0.003053473675635259, 0.01858629683511374, 0.03211024523528374, 0.006287187200054635, 0.008162966365682965, 0.002784068745676082, 4.805977147086039, 6.058439659668181, 33.337968518023146, 567.048680743208, 0.023057126019690392, 0.15484384744381266, 0.2091678602616477, 0.06525425802405246, 0.06308179645938336, 0.01782827597571842];

    clearBtn.addEventListener("click", () => {
      featuresBox.value = "";
      resultBox.classList.add("hidden");
    });

    predictBtn.addEventListener("click", async () => {
      resultBox.classList.remove("hidden");
      output.textContent = "Running inference...";

      const inputText = featuresBox.value.trim();
      if (!inputText) {
        output.textContent = "Please enter input features.";
        return;
      }

      const inputArray = inputText.split(",").map(v => parseFloat(v.trim()));
      if (inputArray.length !== 30) {
        output.textContent = `Expected 30 features, got ${inputArray.length}.`;
        return;
      }
      if (inputArray.some(isNaN)) {
        output.textContent = "Invalid numeric input detected!";
        return;
      }

      // === Apply scaling safely ===
      const scaledInput = inputArray.map((x, i) => {
        const s = stds[i] === 0 ? 1 : stds[i];
        return (x - means[i]) / s;
      });

try {
  const session = await ort.InferenceSession.create("models/breast_cancer_deep_mlp.onnx");
  const tensor = new ort.Tensor("float32", Float32Array.from(scaledInput), [1, 30]);
  const results = await session.run({ input: tensor });

  console.log("Model outputs:", Object.keys(results));

  // Get first output dynamically
  const key = results.prob ? "prob" : Object.keys(results)[0];
  let prob = results[key].data[0];

  // ✅ Apply sigmoid only if necessary
  if (prob < 0 || prob > 1) {
  prob = 1 / (1 + Math.exp(-prob));
}

// ⚠️ Invert probability if model learned reversed label order
prob = 1 - prob;

const pred = prob > 0.5 ? "Malignant (1)" : "Benign (0)";
  output.innerHTML = `
    <strong>Predicted Class:</strong> ${pred}<br>
    <strong>Probability of Malignant:</strong> ${(prob * 100).toFixed(2)}%
  `;
} catch (err) {
  console.error("ONNX Error:", err);
  output.textContent = "⚠️ Error loading or running ONNX model.";
}

    });
  </script>
</body>
</html>



